<% content_for :title, "Nowa integracja" %>
<%= render Ui::Layout::Container::DefaultComponent.new do %>
  <div class="flex items-center gap-4 mb-8">
    <div>
      <h1 class="text-3xl font-bold text-base-content">Dodaj integrację</h1>
      <p class="text-base-content/60 mt-2">
        Konfiguracja integracji z <%= @provider&.humanize %>
      </p>
    </div>
  </div>
  <div class="card bg-base-100 shadow-sm border border-base-200">
    <div class="card-body">
      <%= form_with(model: @integration, url: integrations_path, local: true, class: "space-y-6") do |form| %>
        <!-- Hidden provider field -->
        <%= form.hidden_field :provider %>
        <!-- Integration name -->
        <div class="form-control">
          <%= form.label :name, "Nazwa integracji", class: "label" %>
          <%= form.text_field :name, 
                              class: "input input-bordered w-full #{'input-error' if @integration.errors[:name].any?}", 
                              placeholder: "np. Moja Fakturownia" %>
          <% if @integration.errors[:name].any? %>
            <div class="label">
              <span class="label-text-alt text-error">
                <%= @integration.errors[:name].first %>
              </span>
            </div>
          <% end %>
        </div>
        <!-- Provider-specific credentials -->
        <div class="divider">
          <span class="text-base-content/60">Dane uwierzytelniające</span>
        </div>
        <% case @provider %>
        <% when 'fakturownia' %>
          <!-- Fakturownia credentials -->
          <div class="grid md:grid-cols-2 gap-4">
            <div class="form-control">
              <%= label_tag "invoicing_integration[credentials][account]", "Subdomena konta", class: "label" %>
              <%= text_field_tag "invoicing_integration[credentials][account]", 
                                 "", 
                                 class: "input input-bordered w-full", 
                                 placeholder: "twojafirma" %>
              <div class="label">
                <span class="label-text-alt text-base-content/60">
                  Z adresu: https://twojafirma.fakturownia.pl
                </span>
              </div>
            </div>
            <div class="form-control">
              <%= label_tag "invoicing_integration[credentials][api_token]", "Token API", class: "label" %>
              <%= password_field_tag "invoicing_integration[credentials][api_token]", 
                                     "", 
                                     class: "input input-bordered w-full", 
                                     placeholder: "Wprowadź token API" %>
              <div class="label">
                <span class="label-text-alt text-base-content/60">
                  Znajdziesz w: Ustawienia → Ustawienia konta → Integracja
                </span>
              </div>
            </div>
          </div>
          <!-- Instructions -->
          <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            <div>
              <h4 class="font-semibold">Jak pobrać dane z Fakturowni:</h4>
              <ol class="list-decimal list-inside text-sm mt-2 space-y-1">
                <li>Zaloguj się do swojego konta Fakturownia</li>
                <li>Przejdź do <strong>Ustawienia → Ustawienia konta → Integracja</strong></li>
                <li>W sekcji "Kod autoryzacyjny API" skopiuj token</li>
                <li>Subdomena to część przed ".fakturownia.pl" w adresie Twojego konta</li>
              </ol>
            </div>
          </div>
        <% end %>
        <!-- Validation errors -->
        <% if @integration.errors[:credentials].any? %>
          <div class="alert alert-error">
            <i class="fas fa-exclamation-triangle"></i>
            <span><%= @integration.errors[:credentials].first %></span>
          </div>
        <% end %>
        <!-- Action buttons -->
        <div class="flex justify-end gap-3 pt-6">
          <%= link_to "Anuluj", integrations_path, class: "btn btn-ghost" %>
          <%= form.submit "Zapisz integrację", class: "btn btn-primary" %>
        </div>
      <% end %>
    </div>
  </div>
  <!-- Help section -->
  <div class="mt-8 text-center">
    <p class="text-base-content/50 text-sm">
      Potrzebujesz pomocy? 
      <a href="#" class="link link-primary">Zobacz instrukcję</a>
    </p>
  </div>
<% end %>
