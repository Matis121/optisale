<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold">Faktura <%= @invoice.invoice_number %></h1>
    <div class="flex items-center gap-2">
      <%= link_to invoices_path, class: "btn btn-ghost" do %>
        <i class="fas fa-arrow-left mr-2"></i>
        Powrót do listy
      <% end %>
      <% if @invoice.view_url %>
        <%= link_to @invoice.view_url, target: "_blank", class: "btn btn-primary" do %>
          <i class="fas fa-external-link-alt mr-2"></i>
          Otwórz w <%= @invoice.billing_integration.provider.humanize %>
        <% end %>
      <% end %>
    </div>
  </div>
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Informacje o fakturze -->
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body">
        <h2 class="card-title">
          <i class="fas fa-file-invoice mr-2"></i>
          Informacje o fakturze
        </h2>
        <div class="space-y-3">
          <div class="flex justify-between">
            <span class="text-base-content/60">Numer faktury:</span>
            <span class="font-medium"><%= @invoice.invoice_number %></span>
          </div>
          <div class="flex justify-between">
            <span class="text-base-content/60">Status:</span>
            <span class="badge badge-<%= @invoice.status_color %>">
              <%= @invoice.status_label %>
            </span>
          </div>
          <div class="flex justify-between">
            <span class="text-base-content/60">Kwota:</span>
            <span class="font-bold text-lg"><%= @invoice.formatted_amount %></span>
          </div>
          <div class="flex justify-between">
            <span class="text-base-content/60">Data wystawienia:</span>
            <span><%= @invoice.issue_date&.strftime("%d.%m.%Y") %></span>
          </div>
          <div class="flex justify-between">
            <span class="text-base-content/60">Termin płatności:</span>
            <span>
              <%= @invoice.due_date&.strftime("%d.%m.%Y") %>
              <% if @invoice.overdue? %>
                <span class="badge badge-error badge-xs ml-1">Przeterminowana</span>
              <% elsif @invoice.days_until_due %>
                <span class="text-xs text-base-content/60">
                  (<%= @invoice.days_until_due %> dni)
                </span>
              <% end %>
            </span>
          </div>
          <% if @invoice.external_id %>
            <div class="flex justify-between">
              <span class="text-base-content/60">ID zewnętrzne:</span>
              <span class="font-mono text-sm"><%= @invoice.external_id %></span>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    <!-- Informacje o zamówieniu -->
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body">
        <h2 class="card-title">
          <i class="fas fa-shopping-cart mr-2"></i>
          Powiązane zamówienie
        </h2>
        <div class="space-y-3">
          <div class="flex justify-between">
            <span class="text-base-content/60">Numer zamówienia:</span>
            <%= link_to @invoice.order, class: "link link-primary font-medium" do %>
              #<%= @invoice.order.id %>
            <% end %>
          </div>
          <div class="flex justify-between">
            <span class="text-base-content/60">Data zamówienia:</span>
            <span><%= @invoice.order.created_at.strftime("%d.%m.%Y %H:%M") %></span>
          </div>
          <% if @invoice.order.customer %>
            <div class="flex justify-between">
              <span class="text-base-content/60">Klient:</span>
              <span><%= @invoice.order.customer.email %></span>
            </div>
          <% end %>
        </div>
      </div>
    </div>
    <!-- Integracja -->
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body">
        <h2 class="card-title">
          <i class="fas fa-plug mr-2"></i>
          System fakturowania
        </h2>
        <div class="space-y-3">
          <div class="flex justify-between">
            <span class="text-base-content/60">Provider:</span>
            <span class="badge badge-outline">
              <%= @invoice.billing_integration.provider.humanize %>
            </span>
          </div>
          <div class="flex justify-between">
            <span class="text-base-content/60">Nazwa integracji:</span>
            <span><%= @invoice.billing_integration.name %></span>
          </div>
          <div class="flex justify-between">
            <span class="text-base-content/60">Status integracji:</span>
            <span class="badge badge-<%= @invoice.billing_integration.active? ? 'success' : 'error' %>">
              <%= @invoice.billing_integration.active? ? 'Aktywna' : 'Nieaktywna' %>
            </span>
          </div>
        </div>
      </div>
    </div>
    <!-- Akcje -->
    <div class="card bg-base-100 shadow-lg">
      <div class="card-body">
        <h2 class="card-title">
          <i class="fas fa-cogs mr-2"></i>
          Akcje
        </h2>
        <div class="space-y-3">
          <%= link_to sync_status_invoice_path(@invoice), 
                      data: { turbo_method: :post },
                      class: "btn btn-outline btn-block" do %>
            <i class="fas fa-sync mr-2"></i>
            Synchronizuj status
          <% end %>
          <% unless @invoice.cancelled? %>
            <%= link_to cancel_invoice_path(@invoice), 
                        data: { turbo_method: :post, 
                               turbo_confirm: "Czy na pewno chcesz anulować tę fakturę?" },
                        class: "btn btn-warning btn-block" do %>
              <i class="fas fa-ban mr-2"></i>
              Anuluj fakturę
            <% end %>
          <% end %>
          <%= link_to delete_from_external_invoice_path(@invoice), 
                      data: { turbo_method: :delete, 
                             turbo_confirm: "Czy na pewno chcesz usunąć tę fakturę z #{@invoice.billing_integration.provider.humanize} i z lokalnej bazy? Ta operacja jest nieodwracalna!" },
                      class: "btn btn-error btn-block" do %>
            <i class="fas fa-trash mr-2"></i>
            Usuń fakturę
          <% end %>
          <%= link_to @invoice, 
                      data: { turbo_method: :delete, 
                             turbo_confirm: "Czy na pewno chcesz usunąć tę fakturę tylko z lokalnej bazy?" },
                      class: "btn btn-ghost btn-block" do %>
            <i class="fas fa-database mr-2"></i>
            Usuń tylko lokalnie
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
