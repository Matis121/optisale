<% content_for :title, "Faktura - #{@invoice.invoice_number}" %>
<%= render Ui::Layout::Container::DefaultComponent.new do %>
  <!-- Header -->
  <%= render Ui::Layout::Header::DefaultComponent.new(title: "Faktura - #{@invoice.invoice_number}") %>
  <!-- Action buttons -->
  <div class="flex gap-3 mb-6">
    <%= link_to edit_invoice_path(@invoice), class: "btn btn-primary", data: { turbo_frame: "_top" } do %>
      <i class="fas fa-edit"></i>
      Edytuj fakturę
    <% end %>
    <%= button_to invoice_path(@invoice), method: :delete, class: "btn btn-error", data: { turbo_confirm: "Czy na pewno chcesz usunąć tę fakturę?", turbo_frame: "_top" } do %>
      <i class="fas fa-trash"></i>
      Usuń fakturę
    <% end %>
    <%= link_to order_path(@invoice.order), class: "btn btn-ghost", data: { turbo_frame: "_top" } do %>
      <i class="fas fa-shopping-cart"></i>
      Zobacz zamówienie
    <% end %>
  </div>
  <%= render Ui::Layout::Table::DefaultComponent.new do |component| %>
    <% component.with_table_header do %>
      <thead class="bg-base-300">
        <tr>
          <th class="text-base-content font-semibold">Nazwa produktu</th>
          <th class="text-base-content font-semibold">SKU</th>
          <th class="text-base-content font-semibold">EAN</th>
          <th class="text-base-content font-semibold">Ilość</th>
          <th class="text-base-content font-semibold">Cena netto</th>
          <th class="text-base-content font-semibold">VAT</th>
          <th class="text-base-content font-semibold">Cena brutto</th>
          <th class="text-base-content font-semibold">Akcje</th>
        </tr>
      </thead>
    <%end %>
    <% component.with_table_body do %>
      <tbody>
        <% @invoice.invoice_items.each do |item| %>
          <tr>
            <td class="font-medium"><%= item.name %></td>
            <td><%= item.sku %></td>
            <td><%= item.ean %></td>
            <td><%= item.quantity %></td>
            <td><%= item.price_netto %></td>
            <td><%= item.tax_rate %></td>
            <td><%= item.price_brutto %></td>
            <td>
              <%= button_to invoice_invoice_item_path(@invoice, item), 
                method: :delete, 
                class: "btn btn-sm btn-error btn-ghost",
                data: { 
                  turbo_confirm: "Czy na pewno chcesz usunąć ten produkt z faktury?",
                  turbo_frame: "_top"
                },
                title: "Usuń produkt" do %>
                <i class="fas fa-trash"></i>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
      <% if @invoice.invoice_items.empty? %>
        <%= render Ui::Layout::Table::EmptyStateComponent.new(icon: "fa-file-invoice", title: "Brak produktów", href_turbo: false ) %>
      <% end %>
    <% end %>
  <% end %>
  <div class="mt-3 mb-6 flex justify-end">
    <%= button_to restore_products_invoice_path(@invoice), method: :post, class: "btn btn-sm btn-outline", data: { turbo_frame: "_top" } do %>
      <i class="fas fa-undo"></i>
      Przywróć produkty z zamówienia
    <% end %>
  </div>
  <!-- Summary Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <!-- Total Brutto - Most Important -->
    <div class="card shadow-md border border-gray-500/30 bg-base-300">
      <div class="card-body p-5">
        <div class="flex items-center justify-between mb-2">
          <div class="text-sm font-medium text-base-content/70 uppercase">Suma brutto</div>
        </div>
        <div class="text-3xl font-bold text-primary">
          <%= number_to_currency(@invoice.total_price_brutto, unit: "#{@invoice.currency} ", separator: ",", delimiter: " ") %>
        </div>
      </div>
    </div>
    <!-- Total Netto -->
    <div class="card shadow-md border border-gray-500/30 bg-base-300">
      <div class="card-body p-5">
        <div class="flex items-center justify-between mb-2">
          <div class="text-sm font-medium text-base-content/70 uppercase">Suma netto</div>
        </div>
        <div class="text-2xl font-bold text-base-content">
          <%= number_to_currency(@invoice.total_price_netto, unit: "#{@invoice.currency} ", separator: ",", delimiter: " ") %>
        </div>
      </div>
    </div>
    <!-- Payment Method -->
    <div class="card shadow-md border border-gray-500/30 bg-base-300">
      <div class="card-body p-5">
        <div class="flex items-center justify-between mb-2">
          <div class="text-sm font-medium text-base-content/70 uppercase">Metoda płatności</div>
        </div>
        <div class="text-lg font-semibold text-base-content">
          <%= @invoice.payment_method %>
        </div>
      </div>
    </div>
  </div>
  <!-- Invoice Details Card -->
  <div class="card shadow-md border border-gray-500/30 mb-6 bg-base-300">
    <div class="card-body">
      <div class="flex items-center gap-3 mb-6 pb-4 border-b border-gray-500/30">
        <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
          <i class="fas fa-file-invoice text-primary"></i>
        </div>
        <h2 class="text-lg font-semibold text-base-content">Szczegóły faktury</h2>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Left Column - Invoice Info -->
        <div class="space-y-6">
          <div class="space-y-4">
            <div>
              <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-1">Numer faktury</div>
              <div class="text-lg font-bold text-base-content">
                <%= @invoice.invoice_number %>
              </div>
              <% if @invoice.external_invoice_number.present? %>
                <div class="text-xs text-base-content/50 mt-1">
                  <span class="font-medium">Zewnętrzny:</span> <%= @invoice.external_invoice_number %>
                </div>
              <% end %>
            </div>
            <div>
              <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-1">Data wystawienia</div>
              <div class="text-lg font-semibold text-base-content">
                <%= @invoice.date_sell&.strftime("%d.%m.%Y") %>
              </div>
            </div>
            <div>
              <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-1">Zamówienie</div>
              <div class="text-lg font-semibold">
                <%= link_to order_path(@invoice.order), 
                      class: "link link-primary hover:link-secondary", 
                      data: { turbo_frame: "_top" } do %>
                  #<%= @invoice.order.id %>
                <% end %>
              </div>
            </div>
            <div>
              <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-1">Waluta</div>
              <div class="text-lg font-semibold text-base-content">
                <%= @invoice.currency %>
              </div>
            </div>
          </div>
        </div>
        <!-- Right Column - Customer Info -->
        <div class="space-y-6">
          <div class="space-y-4">
            <div>
              <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-1">Nazwa / Firma</div>
              <div class="text-lg font-semibold text-base-content">
                <%= @invoice.invoice_company.presence || @invoice.invoice_fullname %>
              </div>
            </div>
            <% if @invoice.invoice_company.present? %>
              <div>
                <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-1">Imię i nazwisko</div>
                <div class="text-lg font-semibold text-base-content">
                  <%= @invoice.invoice_fullname %>
                </div>
              </div>
            <% end %>
            <div>
              <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-1">NIP</div>
              <div class="text-lg font-mono font-semibold text-base-content">
                <%= @invoice.invoice_nip %>
              </div>
            </div>
            <div>
              <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-1">Adres</div>
              <div class="text-base text-base-content leading-relaxed">
                <div class="font-semibold"><%= @invoice.invoice_street %></div>
                <div><%= @invoice.invoice_postcode %> <%= @invoice.invoice_city %></div>
                <div class="text-sm text-base-content/70"><%= @invoice.invoice_country %></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="mt-3 mb-6 flex justify-end">
    <%= link_to restore_customer_data_invoice_path(@invoice), method: :post, class: "btn btn-sm btn-outline", data: { turbo_confirm: "Czy na pewno chcesz przywrócić dane klienta z zamówienia? Obecne dane zostaną nadpisane.", turbo_frame: "_top" } do %>
      <i class="fas fa-undo"></i>
      Przywróć dane z zamówienia
    <% end %>
  </div>
  <!-- Additional Information Card -->
  <% if @invoice.additional_info.present? || @invoice.seller.present? || @invoice.issuer.present? %>
    <div class="card shadow-md border border-gray-500/30 mb-6 bg-base-300">
      <div class="card-body">
        <div class="flex items-center gap-3 mb-4 pb-3 border-b border-base-300">
          <div class="w-10 h-10 rounded-full bg-info/10 flex items-center justify-center flex-shrink-0">
            <i class="fas fa-info-circle text-info"></i>
          </div>
          <h2 class="text-lg font-semibold text-base-content">Dane dodatkowe</h2>
        </div>
        <div class="space-y-4">
          <% if @invoice.seller.present? %>
            <div class="flex items-start gap-3">
              <div class="flex-1">
                <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-1">Sprzedawca</div>
                <div class="text-base font-semibold text-base-content"><%= @invoice.seller %></div>
              </div>
            </div>
          <% end %>
          <% if @invoice.issuer.present? %>
            <div class="flex items-start gap-3">
              <div class="flex-1">
                <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-1">Osoba wystawiająca</div>
                <div class="text-base font-semibold text-base-content"><%= @invoice.issuer %></div>
              </div>
            </div>
          <% end %>
          <% if @invoice.additional_info.present? %>
            <div class="bg-base-200/50 rounded-lg p-4">
              <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-2">Informacje dodatkowe</div>
              <p class="text-base text-base-content whitespace-pre-wrap leading-relaxed"><%= @invoice.additional_info %></p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
<% end %>
