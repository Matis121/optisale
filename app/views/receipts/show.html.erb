<% content_for :title, "Paragon - #{@receipt.receipt_number}" %>
<div class="border-b border-gray-500/30 rounded-none py-2 px-4">
  <!-- Header -->
  <div class="breadcrumbs text-sm">
    <ul>
      <li><%= link_to "Paragony", receipts_path %></li>
      <li><%= @receipt.receipt_number %></li>
    </ul>
  </div>
</div>
<%= render Ui::Layout::Container::DefaultComponent.new do %>
  <!-- Action buttons -->
  <div class="flex gap-3 mb-6">
    <%= link_to edit_receipt_path(@receipt), class: "btn btn-primary", data: { turbo_frame: "_top" } do %>
      <i class="fas fa-edit"></i>
      Edytuj
    <% end %>
    <%= button_to receipt_path(@receipt), method: :delete, class: "btn btn-outline btn-error", data: { turbo_confirm: "Czy na pewno chcesz usunąć ten paragon?", turbo_frame: "_top" } do %>
      <i class="fas fa-trash"></i>
      Usuń
    <% end %>
    <%= link_to order_path(@receipt.order), class: "btn btn-ghost", data: { turbo_frame: "_top" } do %>
      <i class="fas fa-shopping-cart"></i>
      Zobacz zamówienie
    <% end %>
  </div>
  <%= render Ui::Layout::Table::DefaultComponent.new do |component| %>
    <% component.with_table_header do %>
      <thead class="bg-base-300">
        <tr>
          <th class="text-base-content font-semibold">Nazwa produktu</th>
          <th class="text-base-content font-semibold">SKU</th>
          <th class="text-base-content font-semibold">EAN</th>
          <th class="text-base-content font-semibold">Ilość</th>
          <th class="text-base-content font-semibold">VAT</th>
          <th class="text-base-content font-semibold">Cena brutto</th>
          <th class="text-base-content font-semibold">Akcje</th>
        </tr>
      </thead>
    <%end %>
    <% component.with_table_body do %>
      <tbody>
        <% @receipt.receipt_items.each do |item| %>
          <tr>
            <td class="font-medium"><%= item.name %></td>
            <td><%= item.sku %></td>
            <td><%= item.ean %></td>
            <td><%= item.quantity %></td>
            <td><%= item.tax_rate %>%</td>
            <td><%= number_to_currency(item.price_brutto, unit: "#{@receipt.currency} ", separator: ",", delimiter: " ") %></td>
            <td>
              <%= button_to receipt_receipt_item_path(@receipt, item), 
                method: :delete, 
                class: "btn btn-sm btn-error btn-ghost",
                data: { 
                  turbo_confirm: "Czy na pewno chcesz usunąć ten produkt z paragonu?",
                  turbo_frame: "_top"
                },
                title: "Usuń produkt" do %>
                <i class="fas fa-trash"></i>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
      <% if @receipt.receipt_items.empty? %>
        <%= render Ui::Layout::Table::EmptyStateComponent.new(icon: "fa-file-invoice-dollar", title: "Brak produktów", href_turbo: false ) %>
      <% end %>
    <% end %>
  <% end %>
  <div class="mt-3 mb-6 flex justify-end">
    <%= button_to restore_products_receipt_path(@receipt), method: :post, class: "btn btn-sm btn-outline", data: { turbo_frame: "_top" } do %>
      <i class="fas fa-undo"></i>
      Przywróć produkty z zamówienia
    <% end %>
  </div>
  <!-- Summary Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
    <!-- Total Brutto - Most Important -->
    <div class="card shadow-md border border-gray-500/30 bg-base-300">
      <div class="card-body p-5">
        <div class="flex items-center justify-between mb-2">
          <div class="text-sm font-medium text-base-content/70 uppercase">Suma brutto</div>
        </div>
        <div class="text-3xl font-bold text-primary">
          <%= number_to_currency(@receipt.total_price_brutto, unit: "#{@receipt.currency} ", separator: ",", delimiter: " ") %>
        </div>
      </div>
    </div>
    <!-- Payment Method -->
    <div class="card shadow-md border border-gray-500/30 bg-base-300">
      <div class="card-body p-5">
        <div class="flex items-center justify-between mb-2">
          <div class="text-sm font-medium text-base-content/70 uppercase">Metoda płatności</div>
        </div>
        <div class="text-lg font-semibold text-base-content">
          <%= @receipt.payment_method %>
        </div>
      </div>
    </div>
  </div>
  <!-- Receipt Details Card -->
  <div class="card shadow-md border border-gray-500/30 mb-6 bg-base-300">
    <div class="card-body">
      <div class="flex items-center gap-3 mb-6 pb-4 border-b border-gray-500/30">
        <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
          <i class="fas fa-file-invoice-dollar text-primary"></i>
        </div>
        <h2 class="text-lg font-semibold text-base-content">Szczegóły paragonu</h2>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Left Column - Receipt Info -->
        <div class="space-y-6">
          <div class="space-y-4">
            <div>
              <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-1">Numer paragonu</div>
              <div class="text-lg font-bold text-base-content">
                <%= @receipt.receipt_number %>
              </div>
              <% if @receipt.external_receipt_number.present? %>
                <div class="text-xs text-base-content/50 mt-1">
                  <span class="font-medium">Zewnętrzny:</span> <%= @receipt.external_receipt_number %>
                </div>
              <% end %>
            </div>
            <div>
              <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-1">Data dodania</div>
              <div class="text-lg font-semibold text-base-content">
                <%= @receipt.date_add&.strftime("%d.%m.%Y") %>
              </div>
            </div>
            <div>
              <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-1">Zamówienie</div>
              <div class="text-lg font-semibold">
                <%= link_to order_path(@receipt.order), 
                      class: "link link-primary hover:link-secondary", 
                      data: { turbo_frame: "_top" } do %>
                  #<%= @receipt.order.id %>
                <% end %>
              </div>
            </div>
            <div>
              <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-1">Waluta</div>
              <div class="text-lg font-semibold text-base-content">
                <%= @receipt.currency %>
              </div>
            </div>
          </div>
        </div>
        <!-- Right Column - Additional Info -->
        <div class="space-y-6">
          <div class="space-y-4">
            <% if @receipt.nip.present? %>
              <div>
                <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-1">NIP</div>
                <div class="text-lg font-mono font-semibold text-base-content">
                  <%= @receipt.nip %>
                </div>
              </div>
            <% end %>
            <% if @receipt.external_id.present? %>
              <div>
                <div class="text-xs font-semibold text-base-content/60 uppercase tracking-wide mb-1">Zewnętrzne ID</div>
                <div class="text-lg font-semibold text-base-content">
                  <%= @receipt.external_id %>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>
