<style>
  .sidebar-section summary {
    list-style: none;
  }
  .sidebar-section summary::-webkit-details-marker {
    display: none;
    opacity: 0;
  }
  .sidebar-section .menu-content {
    overflow: hidden;
    transition: height 0.1s ease-out;
    opacity: 1;
  }
</style>
<div class="fixed top-0 left-0 h-full w-62 text-base-content flex flex-col">
  <!-- Header/Logo Section -->
  <div class="pl-4 pr-5 py-4 border-b border-base-300/50 shrink-0">
    <div class="flex items-center gap-2.5">
      <div class="w-9 h-9 bg-primary rounded-lg flex items-center justify-center">
        <i class="fas fa-chart-line text-primary-content text-lg"></i>
      </div>
      <%= link_to root_path do %>
        <h1 class="text-lg font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">
          Optisale
        </h1>
        <p class="text-[10px] text-base-content/60">Panel zarządzania</p>
      <% end %>
    </div>
  </div>
  <!-- Main Navigation -->
  <nav class="flex-1 pl-3 pr-4 py-4 space-y-1.5 overflow-y-auto scrollbar-hide">
    <!-- Home Link -->
    <div class="mb-3">
      <%= link_to root_path, class: "flex items-center gap-2.5 px-2.5 py-2 rounded-lg hover:bg-base-200/70 transition-all duration-200 group #{current_page?(root_path) ? 'bg-primary/10' : ''}" do %>
        <div class="w-7 h-7 flex items-center justify-center rounded-md bg-base-300 text-base-content transition-transform">
          <i class="fas fa-home text-sm"></i>
        </div>
        <span class="flex-1  text-sm <%= 'text-primary ' if current_page?(root_path) %>">Strona główna</span>
      <% end %>
    </div>
    <!-- Zamówienia Section -->
    <div class="mb-3">
      <div class="sidebar-section group" data-open="<%= request.path.start_with?('/orders', '/invoices', '/order_statuses', '/receipts') %>">
        <button type="button" class="sidebar-toggle w-full flex items-center gap-2.5 px-2.5 py-2 rounded-lg cursor-pointer hover:bg-base-200/70 transition-all duration-200 group-data-[open=true]:bg-base-200/50">
          <div class="w-7 h-7 flex items-center justify-center rounded-md bg-base-300 text-base-content transition-transform">
            <i class="fas fa-shopping-cart text-sm"></i>
          </div>
          <span class="flex-1 text-sm text-left">Zamówienia</span>
          <i class="fas fa-chevron-down text-[10px] transition-transform duration-200 group-data-[open=true]:rotate-180"></i>
        </button>
        <div class="menu-content">
          <ul class="mt-1.5 ml-6 mr-2 space-y-0.5">
            <li><%= link_to "Lista zamówień", orders_path(status: "all"), class: "block px-2.5 py-1.5 rounded-md text-sm hover:bg-base-200/70 transition-all duration-200 #{current_page?(orders_path) ? 'bg-primary/10 text-primary ' : ''}" %></li>
            <li><%= link_to "Faktury i paragony", invoices_path, class: "block px-2.5 py-1.5 rounded-md text-sm hover:bg-base-200/70 transition-all duration-200 #{(current_page?(invoices_path) || current_page?(receipts_path)) ? 'bg-primary/10 text-primary ' : ''}" %></li>
            <li><%= link_to "Statusy zamówień", order_statuses_path, class: "block px-2.5 py-1.5 rounded-md text-sm hover:bg-base-200/70 transition-all duration-200 #{current_page?(order_statuses_path) ? 'bg-primary/10 text-primary ' : ''}" %></li>
            <li>
              <div class="flex items-center justify-between px-2.5 py-1.5 rounded-md text-sm cursor-not-allowed opacity-60">
                <span>Automatyczne akcje</span>
                <span class="badge badge-ghost badge-xs text-[8px] py-0 px-1.5">Wkrótce</span>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <!-- Produkty Section -->
    <div class="mb-3">
      <div class="sidebar-section group" data-open="<%= request.path.start_with?('/storage') %>">
        <button type="button" class="sidebar-toggle w-full flex items-center gap-2.5 px-2.5 py-2 rounded-lg cursor-pointer hover:bg-base-200/70 transition-all duration-200 group-data-[open=true]:bg-base-200/50">
          <div class="w-7 h-7 flex items-center justify-center rounded-md bg-base-300 text-base-content transition-transform">
            <i class="fas fa-box text-sm"></i>
          </div>
          <span class="flex-1 text-sm text-left">Produkty</span>
          <i class="fas fa-chevron-down text-[10px] transition-transform duration-200 group-data-[open=true]:rotate-180"></i>
        </button>
        <div class="menu-content">
          <ul class="mt-1.5 ml-6 mr-2 space-y-0.5">
            <li><%= link_to "Lista produktów", storage_products_path, class: "block px-2.5 py-1.5 rounded-md text-sm hover:bg-base-200/70 transition-all duration-200 #{current_page?(storage_products_path) ? 'bg-primary/10 text-primary ' : ''}" %></li>
            <li><%= link_to "Katalogi", storage_catalogs_path, class: "block px-2.5 py-1.5 rounded-md text-sm hover:bg-base-200/70 transition-all duration-200 #{current_page?(storage_catalogs_path) ? 'bg-primary/10 text-primary ' : ''}" %></li>
            <li><%= link_to "Magazyny", storage_warehouses_path, class: "block px-2.5 py-1.5 rounded-md text-sm hover:bg-base-200/70 transition-all duration-200 #{current_page?(storage_warehouses_path) ? 'bg-primary/10 text-primary ' : ''}" %></li>
            <li><%= link_to "Grupy cenowe", storage_price_groups_path, class: "block px-2.5 py-1.5 rounded-md text-sm hover:bg-base-200/70 transition-all duration-200 #{current_page?(storage_price_groups_path) ? 'bg-primary/10 text-primary ' : ''}" %></li>
            <li>
              <div class="flex items-center justify-between px-2.5 py-1.5 rounded-md text-sm cursor-not-allowed opacity-60">
                <span>Import/Eksport</span>
                <span class="badge badge-ghost badge-xs text-[8px] py-0 px-1.5">Wkrótce</span>
              </div>
            </li>
            <li>
              <div class="flex items-center justify-between px-2.5 py-1.5 rounded-md text-sm cursor-not-allowed opacity-60">
                <span>Ustawienia</span>
                <span class="badge badge-ghost badge-xs text-[8px] py-0 px-1.5">Wkrótce</span>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <!-- Settings Section -->
    <div class="mb-3">
      <div class="sidebar-section group" data-open="<%= request.path.start_with?('/tags') %>">
        <button type="button" class="sidebar-toggle w-full flex items-center gap-2.5 px-2.5 py-2 rounded-lg cursor-pointer hover:bg-base-200/70 transition-all duration-200 group-data-[open=true]:bg-base-200/50">
          <div class="w-7 h-7 flex items-center justify-center rounded-md bg-base-300 text-base-content transition-transform">
            <i class="fas fa-cog text-sm"></i>
          </div>
          <span class="flex-1 text-sm text-left">Ustawienia</span>
          <i class="fas fa-chevron-down text-[10px] transition-transform duration-200 group-data-[open=true]:rotate-180"></i>
        </button>
        <div class="menu-content">
          <ul class="mt-1.5 ml-6 mr-2 space-y-0.5">
            <li><%= link_to "Tagi (Zamówienia / Produkty)", tags_path, class: "block px-2.5 py-1.5 rounded-md text-sm hover:bg-base-200/70 transition-all duration-200 #{current_page?(tags_path) ? 'bg-primary/10 text-primary ' : ''}" %></li>
          </ul>
        </div>
      </div>
    </div>
    <!-- Single Items -->
    <div class="space-y-1.5">
      <%= link_to account_integrations_path, class: "flex items-center gap-2.5 px-2.5 py-2 rounded-lg hover:bg-base-200/70 transition-all duration-200 group #{current_page?(account_integrations_path) || controller_name == 'account_integrations' ? 'bg-primary/10' : ''}" do %>
        <div class="w-7 h-7 flex items-center justify-center rounded-md bg-base-300 text-base-content transition-transform">
          <i class="fas fa-plug text-sm"></i>
        </div>
        <span class="flex-1  text-sm <%= 'text-primary ' if controller_name == 'account_integrations' %>">Integracje</span>
      <% end %>
      <%= link_to manage_users_path, class: "flex items-center gap-2.5 px-2.5 py-2 rounded-lg hover:bg-base-200/70 transition-all duration-200 group #{current_page?(manage_users_path) || controller_name == 'users' ? 'bg-primary/10' : ''}" do %>
        <div class="w-7 h-7 flex items-center justify-center rounded-md bg-base-300 text-base-content transition-transform">
          <i class="fas fa-users text-sm"></i>
        </div>
        <span class="flex-1  text-sm <%= 'text-primary ' if controller_name == 'users' %>">Użytkownicy</span>
      <% end %>
    </div>
    <!-- Marketplace Section -->
    <div class="mt-6 pt-4 border-t border-base-300/50 opacity-50">
      <div class="pl-2.5 pr-3 mb-2 flex items-center gap-2 justify-between">
        <div class="flex items-center gap-2">
          <i class="fas fa-store text-[10px] text-base-content/40"></i>
          <h3 class="text-[10px] font-bold text-base-content/60 tracking-wider uppercase">Marketplace</h3>
        </div>
        <span class="badge badge-ghost badge-xs text-[8px] py-0 px-1.5">Wkrótce</span>
      </div>
      <ul class="space-y-0.5">
        <li>
          <div class="flex items-center gap-2.5 px-2.5 py-2 rounded-lg cursor-not-allowed">
            <span class="flex items-center justify-center w-7 h-7 rounded-md bg-base-300 text-base-content/50 font-bold text-[10px]">Al</span>
            <span class="flex-1  text-sm text-base-content/50">Allegro</span>
          </div>
        </li>
        <li>
          <div class="flex items-center gap-2.5 px-2.5 py-2 rounded-lg cursor-not-allowed">
            <span class="flex items-center justify-center w-7 h-7 rounded-md bg-base-300 text-base-content/50 font-bold text-[10px]">Em</span>
            <span class="flex-1  text-sm text-base-content/50">Empik</span>
          </div>
        </li>
        <li>
          <div class="flex items-center gap-2.5 px-2.5 py-2 rounded-lg cursor-not-allowed">
            <span class="flex items-center justify-center w-7 h-7 rounded-md bg-base-300 text-base-content/50 font-bold text-[10px]">Ce</span>
            <span class="flex-1  text-sm text-base-content/50">Ceneo</span>
          </div>
        </li>
      </ul>
    </div>
  </nav>
  <!-- Footer Section (Optional User Info) -->
  <div class="pl-3 pr-4 py-3 border-t border-base-300/50 shrink-0">
    <div class="flex items-center gap-2.5 px-1.5 py-1.5 mb-2">
      <div class="avatar avatar-placeholder">
        <div class="bg-primary text-primary-content w-8 h-8 rounded-full flex items-center justify-center">
          <p class="text-sm  w-fit">
            <%= current_user.email.first(2).upcase %>
          </p>
        </div>
      </div>
      <div class="flex-1 min-w-0">
        <p class="text-sm  truncate"><%= current_account.name %></p>
        <p class="text-[10px] text-base-content/60 truncate">Panel administracyjny</p>
      </div>
    </div>
    <%= button_to destroy_user_session_path, method: :delete, class: "w-full flex items-center gap-2.5 px-2.5 py-2 rounded-lg hover:bg-error/10 hover:text-error transition-all duration-200 group text-left", data: { turbo_confirm: "Czy na pewno chcesz się wylogować?" } do %>
      <div class="w-7 h-7 flex items-center justify-center rounded-md bg-base-300 text-base-content group-hover:bg-error/10 group-hover:text-error transition-all duration-200">
        <i class="fas fa-sign-out-alt text-xs"></i>
      </div>
      <span class="flex-1  text-sm">Wyloguj się</span>
    <% end %>
  </div>
</div>
<script>
  document.addEventListener('turbo:load', () => {
    document.querySelectorAll('.sidebar-section').forEach(section => {
      const toggle = section.querySelector('.sidebar-toggle');
      const content = section.querySelector('.menu-content');

      content.style.height = section.dataset.open === 'true' ? `${content.scrollHeight}px` : '0';

      toggle.onclick = () => {
        const isOpen = section.dataset.open === 'true';

        // Close others
        document.querySelectorAll('.sidebar-section[data-open="true"]').forEach(s => {
          if (s !== section) {
            s.dataset.open = 'false';
            s.querySelector('.menu-content').style.height = '0';
          }
        });

        // Toggle this
        section.dataset.open = isOpen ? 'false' : 'true';
        content.style.height = isOpen ? '0' : `${content.scrollHeight}px`;
      };
    });
  });
</script>
