<%= turbo_frame_tag dom_id(@order, :product_table) do %>
  <div class="bg-transparent rounded-md border border-gray-500/30">
    <div class="flex justify-between items-center p-4 border-b border-gray-500/30 bg-base-300">
      <h3 class="text-md font-semibold">Produkty w zamówieniu</h3>
      <button class="btn btn-primary btn-sm gap-2" onclick="order_add_product_modal.showModal()">
        <i class="fas fa-plus"></i>
        Dodaj produkt
      </button>
    </div>
    <table class="table w-full">
      <thead class="">
        <tr>
          <th class="text-base-content font-semibold"></th>
          <th class="text-base-content font-semibold">ID PROD.</th>
          <th class="text-base-content font-semibold">NAZWA PRODUKTU</th>
          <th class="text-base-content font-semibold text-center">ILOŚĆ</th>
          <th class="text-base-content font-semibold text-center">CENA</th>
          <th class="text-base-content font-semibold text-center">VAT</th>
          <th class="text-base-content font-semibold text-center">WAGA</th>
          <th class="text-base-content font-semibold text-center">DATA</th>
          <th class="text-base-content font-semibold text-right">AKCJE</th>
        </tr>
      </thead>
      <tbody>
        <% if @order.order_products.any? %>
          <% @order.order_products.each do |op| %>
            <tr class="hover:bg-base-300/50 transition-colors duration-200">
              <td class="py-4 px-6">
                <div class="w-8 h-8 bg-secondary/10 rounded-lg flex items-center justify-center">
                  <i class="fas fa-box text-secondary text-sm"></i>
                </div>
              </td>
              <td class="py-4 px-6">
                <span class="text-xs text-base-content/60">
                  <%= op.id %>
                </span>
              </td>
              <td class="py-4 px-6">
                <div class="font-medium text-base-content"><%= op.name %></div>
                <div class="text-xs text-base-content/60 mt-1">
                  EAN: <%= op.ean %> • SKU: <%= op.sku %>
                </div>
              </td>
              <td class="py-4 px-6 text-center">
                <span class="badge badge-outline badge-sm"><%= op.quantity %></span>
              </td>
              <td class="py-4 px-6 text-center">
                <span class="font-medium text-base-content"><%= op.gross_price || 0 %> PLN</span>
              </td>
              <td class="py-4 px-6 text-center">
                <span class="text-sm text-base-content/80"><%= op.tax_rate || 0 %>%</span>
              </td>
              <td class="py-4 px-6 text-center">
                <span class="text-sm text-base-content/80">0</span>
              </td>
              <td class="py-4 px-6 text-center">
                <div class="text-sm text-base-content/80">
                  <%= op.created_at.strftime('%d.%m.%Y') %>
                  <br>
                  <%= op.created_at.strftime('%H:%M') %>
                </div>
              </td>
              <td class="text-right">
                <div class="flex items-center justify-end gap-2">
                  <div class="dropdown dropdown-end">
                    <div tabindex="0" role="button" class="btn btn-ghost btn-xs">
                      <i class="fas fa-ellipsis-v text-base-content/60"></i>
                    </div>
                    <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow-xl bg-base-100 rounded-box w-32 border border-base-200 overflow-hidden">
                      <li>
                        <%= link_to edit_order_product_path(@order, op), 
                class: "gap-2",
                data: { turbo_frame: "modal-frame" } do %>
                          <i class="fas fa-edit text-base-content"></i> Edytuj
                        <% end %>
                      </li>
                      <li>
                        <%= link_to order_product_path(@order, op), 
                  data: { turbo_method: :delete, turbo_confirm: "Czy na pewno chcesz usunąć ten produkt?" },
                  class: "text-error gap-2" do %>
                          <i class="fas fa-trash"></i> Usuń
                        <% end %>
                      </li>
                    </ul>
                  </div>
                </div>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="9" class="text-center py-16">
              <div class="max-w-sm mx-auto">
                <div class="w-20 h-20 bg-gradient-to-br from-secondary/10 to-accent/10 rounded-2xl flex items-center justify-center mx-auto mb-6">
                  <i class="fas fa-box text-3xl text-primary"></i>
                </div>
                <h3 class="text-xl font-semibold text-base-content mb-3">Brak produktów</h3>
                <p class="text-base-content/60 mb-6">
                  Dodaj produkty do zamówienia, aby rozpocząć.
                </p>
                <button class="btn btn-primary gap-2" onclick="order_add_product_modal.showModal()">
                  <i class="fas fa-plus"></i>
                  Dodaj produkt
                </button>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
<% end %>